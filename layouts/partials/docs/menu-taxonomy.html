<!-- Autopopulate menu with all existing taxonomy categories -->

{{range ($.Site.GetPage "taxonomyTerm" "categories").Pages }}
  {{ $title := humanize .Title }}
  <ul>
    <li>

      <!-- If menuoverride param is set in section _index.md, 
      then go to section's list page. Otherwise, go to autogenerated
      taxonomy page. -->
      {{ $root := strings.TrimPrefix "/categories/" .Title }}
      {{ $indexPath := printf "%s/_index.md" $root }}
      {{ $index := .Site.GetPage $indexPath }}

      {{ if isset $index.Params "menuoverride" }}
      <a href="{{ $index.Permalink }}">{{ $title }}</a></li>
      {{ else }}
      <a href="{{.Permalink}}"> {{ $title }}</a></li>
      {{ end }}

    </li>
  </ul>
{{end}}
